services:
  aria2teldrive:
    image: mengstarr/aria2teldrive:latest
    container_name: aria2teldrive
    restart: unless-stopped
    ports:
      - "8010:8010"
    volumes:
      # /data 包含 config.toml 和 tasks.db，映射后数据持久化
      - ./data:/data
      - ./downloads:/downloads
    environment:
      - TZ=Asia/Shanghai
      # aria2 RPC 地址指向同网络下的 aria2 容器
      - ARIA2_RPC_URL=http://aria2
      - ARIA2_RPC_PORT=6800
      # - ARIA2_RPC_SECRET=
      # - ARIA2_MAX_CONCURRENT=3
      - ARIA2_DOWNLOAD_DIR=/downloads
      # --- teldrive ---
      # - TELDRIVE_API_HOST=http://localhost:7888
      # - TELDRIVE_ACCESS_TOKEN=your_jwt_token
      # - TELDRIVE_CHANNEL_ID=0
      # - TELDRIVE_CHUNK_SIZE=500M
      # - TELDRIVE_UPLOAD_CONCURRENCY=4
      # - TELDRIVE_UPLOAD_DIR=
      # - TELDRIVE_TARGET_PATH=/
      # --- general ---
      # - GENERAL_MAX_RETRIES=3
      # - GENERAL_AUTO_DELETE=true
      # - GENERAL_MAX_DISK_USAGE=0
      # - GENERAL_CPU_LIMIT=85
    depends_on:
      - aria2

  aria2:
    image: p3terx/aria2-pro:latest
    container_name: aria2
    restart: unless-stopped
    ports:
      - "6800:6800"
    volumes:
      - ./downloads:/downloads
      - ./aria2-config:/config
    environment:
      - RPC_PORT=6800
      - RPC_SECRET=
      - PUID=0
      - PGID=0
      - TZ=Asia/Shanghai
